(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1266:function(e,t,s){"use strict";s.r(t);var a=s(1258),c=s.n(a),d=s(1260),r=s.n(d),n=s(1259),o=s.n(n),l=s(533),i=s.n(l),j=s(330),b=s.n(j),u=s(103),O=s.n(u),h=(s(130),s(178),s(240),s(1257),s(329)),m=s(0),x=s(128),v=s(242),p=s(241),k=s(47),w=s(12);t.default=()=>{const e=Object(x.a)(),t=Object(x.c)(),s=Object(x.d)(),[a,d]=Object(m.useState)(),[n,l]=Object(m.useState)();Object(m.useEffect)(()=>{null!=s&&(j(),B(),P())},[s]);const j=async()=>{const e=new t.eth.Contract(v.abi,v.networks[s].address);let a=await e.methods.buyFee().call();d(Object(p.a)(a,12));let c=await e.methods.sellFee().call();l(Object(p.a)(c,12))},[u,g]=Object(m.useState)(),[f,y]=Object(m.useState)(),[N,C]=Object(m.useState)(),[S,R]=Object(m.useState)([]),I=[{title:"用户地址",dataIndex:"address",key:"address"},{title:"操作",key:"action",width:180,render:(e,t,s)=>Object(w.jsx)(O.a,{onClick:F.bind(void 0,t.address),style:{marginTop:"0"},children:"删除"})}],B=async()=>{const e=new t.eth.Contract(v.abi,v.networks[s].address);let a=await e.getPastEvents("Guarded",{fromBlock:0,toBlock:"latest"});if(a.length>0){let e=[];for(let t=0;t<a.length;t++)e.push({key:"Guarded"+t,address:a[t].returnValues.user,addOrRemove:a[t].returnValues.addOrRemove});let t=Object.values(e.reduce((e,t)=>{let{key:s,address:a,addOrRemove:c}=t,d="".concat(a,"_").concat(c);return e[d]?e[d].count+=1:e[d]={key:s,address:a,addOrRemove:c,count:1},e},{}));console.log(t);let s=t.reduce((e,t)=>{let s=e.findIndex(e=>e.address===t.address&&e.addOrRemove!==t.addOrRemove&&e.count===t.count);return s<0?e.push(t):e.splice(s,1),e},[]).reduce((e,t)=>(e.findIndex(e=>e.address===t.address)<0&&e.push(t),e),[]);console.log(t),R(s)}},F=a=>{new t.eth.Contract(v.abi,v.networks[s].address).methods.removeGuarded(a).send({from:e}).on("receipt",e=>{Object(k.a)("删除成功","success"),B()}).on("error",e=>{Object(k.a)("取消","error")})},[G,V]=Object(m.useState)(),[E,T]=Object(m.useState)([]),J=[{title:"用户地址",dataIndex:"address",key:"address"},{title:"操作",key:"action",width:180,render:(e,t,s)=>Object(w.jsx)(O.a,{onClick:_.bind(void 0,t.address),style:{marginTop:"0"},children:"删除"})}],P=async()=>{const e=new t.eth.Contract(v.abi,v.networks[s].address);let a=await e.getPastEvents("Blocked",{fromBlock:0,toBlock:"latest"});if(a.length>0){let e=[];for(let t=0;t<a.length;t++)e.push({key:"Blocked"+t,address:a[t].returnValues.user,addOrRemove:a[t].returnValues.addOrRemove});let t=Object.values(e.reduce((e,t)=>{let{key:s,address:a,addOrRemove:c}=t,d="".concat(a,"_").concat(c);return e[d]?e[d].count+=1:e[d]={key:s,address:a,addOrRemove:c,count:1},e},{}));console.log(t);let s=t.reduce((e,t)=>{let s=e.findIndex(e=>e.address===t.address&&e.addOrRemove!==t.addOrRemove&&e.count===t.count);return s<0?e.push(t):e.splice(s,1),e},[]).reduce((e,t)=>(e.findIndex(e=>e.address===t.address)<0&&e.push(t),e),[]);console.log(t),T(s)}},_=a=>{console.log(a);new t.eth.Contract(v.abi,v.networks[s].address).methods.removeBlocked(a).send({from:e}).on("receipt",e=>{Object(k.a)("删除成功","success"),P()}).on("error",e=>{Object(k.a)("取消","error")})};return Object(w.jsxs)("div",{className:"eth",children:[Object(w.jsxs)("div",{className:"mainTop",children:[Object(w.jsx)(b.a,{}),Object(w.jsx)(h.a,{})]}),Object(w.jsxs)("div",{className:"box",children:[Object(w.jsxs)("div",{className:"title",children:["买入手续费：",a]}),Object(w.jsx)(i.a,{value:u,onInput:e=>{g(e.target.value)},style:{width:"400px"},placeholder:"0~1"}),Object(w.jsx)("div",{className:"item",id:"language-change",children:Object(w.jsx)(O.a,{className:"same-btn",onClick:()=>{const a=new t.eth.Contract(v.abi,v.networks[s].address);let c=Object(p.c)(u,12).toString();console.log(c),a.methods.setBuyFee(c).send({from:e}).on("receipt",e=>{Object(k.a)("设置成功","success"),d(u)}).on("error",e=>{Object(k.a)("取消","error")})},children:"设置"})})]}),Object(w.jsxs)("div",{className:"box",children:[Object(w.jsxs)("div",{className:"title",children:["卖出手续费：",n]}),Object(w.jsx)(i.a,{value:f,onInput:e=>{y(e.target.value)},style:{width:"400px"},placeholder:"0~1"}),Object(w.jsx)("div",{className:"item",id:"language-change",children:Object(w.jsx)(O.a,{className:"same-btn",onClick:()=>{const a=new t.eth.Contract(v.abi,v.networks[s].address);let c=Object(p.c)(f,12).toString();a.methods.setSellFee(c).call({from:e},console.log),a.methods.setSellFee(c).send({from:e}).on("receipt",e=>{Object(k.a)("设置成功","success"),l(f)}).on("error",e=>{Object(k.a)("取消","error")})},children:"设置"})})]}),Object(w.jsx)("div",{className:"box",children:Object(w.jsxs)(c.a,{children:[Object(w.jsxs)(o.a,{span:"12",children:[Object(w.jsx)("div",{className:"title",children:"白名单"}),Object(w.jsx)(i.a,{value:N,onInput:e=>{C(e.target.value)},style:{width:"400px"},placeholder:"地址"}),Object(w.jsx)("div",{className:"item",id:"language-change",children:Object(w.jsx)(O.a,{className:"same-btn",onClick:()=>{new t.eth.Contract(v.abi,v.networks[s].address).methods.addGuarded(N).send({from:e}).on("receipt",e=>{Object(k.a)("设置成功","success"),B()}).on("error",e=>{Object(k.a)("取消","error")})},children:"设置"})})]}),Object(w.jsx)(o.a,{span:12,children:Object(w.jsx)(r.a,{columns:I,dataSource:S})})]})}),Object(w.jsx)("div",{className:"box",children:Object(w.jsxs)(c.a,{children:[Object(w.jsxs)(o.a,{span:"12",children:[Object(w.jsx)("div",{className:"title",children:"黑名单"}),Object(w.jsx)(i.a,{value:G,onInput:e=>{C(e.target.value)},style:{width:"400px"},placeholder:"地址"}),Object(w.jsx)("div",{className:"item",id:"language-change",children:Object(w.jsx)(O.a,{className:"same-btn",onClick:()=>{new t.eth.Contract(v.abi,v.networks[s].address).methods.addBlocked(N).send({from:e}).on("receipt",e=>{Object(k.a)("设置成功","success"),P()}).on("error",e=>{Object(k.a)("取消","error")})},children:"设置"})})]}),Object(w.jsx)(o.a,{span:12,children:Object(w.jsx)(r.a,{columns:J,dataSource:E})})]})})]})}}}]);